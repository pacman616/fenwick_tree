#!/usr/bin/env python3

import sys, numpy, matplotlib, os.path
import matplotlib.pyplot as plt
from matplotlib.ticker import FuncFormatter

matplotlib.rcParams['text.usetex'] = True
matplotlib.rcParams['text.latex.preamble'] = [r'\usepackage{amsmath}']

if __name__ == '__main__':
    fname = os.path.join(sys.argv[1])
    data = numpy.genfromtxt(fname, delimiter=',', missing_values=set([0, '0']), names=True, autostrip=True, case_sensitive=True, deletechars='', dtype=None)
    fig, ax = plt.subplots()
    ax.scatter(data['Length'], data['fixed[F]1'],  label='fixed[F]1')
    ax.scatter(data['Length'], data['fixed[F]8'],  label='fixed[F]8')
    ax.scatter(data['Length'], data['fixed[F]16'], label='fixed[F]16')
    ax.scatter(data['Length'], data['byte[F]1'],   label='byte[F]1')
    ax.scatter(data['Length'], data['byte[F]8'],   label='byte[F]8')
    ax.scatter(data['Length'], data['byte[F]16'],  label='byte[F]16')
    ax.scatter(data['Length'], data['scipy'],      label='SciPy')
    ax.scatter(data['Length'], data['prezza'],     label='Prezza')
    ax.set_yscale('log')

    for t in ['fixed[F]1', 'fixed[F]8', 'fixed[F]16', 'byte[F]1', 'byte[F]8', 'byte[F]16', 'scipy' 'prezza']:
        for i, txt in numpy.ndenumerate(data[t + 'S']):
            ax.annotate(txt, (data['Length'][i], data[t][i]))

    ax.set(xlabel='Size ($2^n$)', ylabel='Time (ns)')
    plt.legend(loc="upper left", ncol=2, shadow=True, fancybox=True, prop={'size': 8}, framealpha=1, frameon=True)
    plt.show()


# if __name__ == '__main__':
#     fname = os.path.join(sys.argv[1])
#     data = numpy.genfromtxt(fname, delimiter=',', missing_values=set([0, '0']), names=True, autostrip=True, case_sensitive=True, deletechars='', dtype=None)
#     plt.plot(data['Length'], data['fixed[F]1'],  's', color='#000000')
#     plt.plot(data['Length'], data['fixed[F]2'],  'v', color='#999999')
#     plt.plot(data['Length'], data['fixed[F]4'],  '^', color='#ff0000')
#     plt.plot(data['Length'], data['fixed[F]8'],  '<', color='#990000')
#     plt.plot(data['Length'], data['fixed[F]16'], '>', color='#00ff00')
#     # plt.plot(data['Length'], data['prezza'],     'o')
#     matplotlib.rcParams.update({'font.size': 8})
#     plt.savefig('transp', format='pdf')
